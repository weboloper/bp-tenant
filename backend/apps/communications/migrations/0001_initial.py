# Generated by Django 5.2.5 on 2026-01-19 21:02

import datetime
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('contenttypes', '0002_remove_content_type_name'),
        ('providers', '0001_initial'),
        ('tenants', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Notification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Updated At')),
                ('is_system_notification', models.BooleanField(default=False, help_text='True if sent by the platform itself', verbose_name='Is System Notification')),
                ('is_broadcast', models.BooleanField(default=False, help_text='True if sent to multiple recipients', verbose_name='Is Broadcast')),
                ('broadcast_target', models.CharField(blank=True, choices=[('all_tenants', 'All Tenants'), ('all_clients', 'All Clients')], max_length=20, verbose_name='Broadcast Target')),
                ('title', models.CharField(max_length=255, verbose_name='Title')),
                ('message', models.TextField(verbose_name='Message')),
                ('notification_type', models.CharField(choices=[('system_announcement', 'System Announcement'), ('billing_alert', 'Billing Alert'), ('feature_update', 'Feature Update'), ('subscription_expiry', 'Subscription Expiry Warning'), ('appointment_reminder', 'Appointment Reminder'), ('appointment_confirmation', 'Appointment Confirmation'), ('appointment_cancelled', 'Appointment Cancelled'), ('birthday_greeting', 'Birthday Greeting'), ('promotion', 'Promotion'), ('feedback_request', 'Feedback Request'), ('platform_update', 'Platform Update'), ('maintenance', 'Maintenance Notice'), ('new_feature', 'New Feature Announcement')], max_length=50, verbose_name='Notification Type')),
                ('channels', models.JSONField(default=list, help_text="List of channels: ['in_app', 'email', 'push', 'sms']", verbose_name='Channels')),
                ('priority', models.CharField(choices=[('low', 'Low'), ('normal', 'Normal'), ('high', 'High'), ('urgent', 'Urgent')], default='normal', max_length=10, verbose_name='Priority')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('delivered', 'Delivered'), ('failed', 'Failed'), ('read', 'Read'), ('rejected', 'Rejected')], default='pending', max_length=20, verbose_name='Status')),
                ('scheduled_at', models.DateTimeField(blank=True, null=True, verbose_name='Scheduled At')),
                ('sent_at', models.DateTimeField(blank=True, null=True, verbose_name='Sent At')),
                ('delivered_at', models.DateTimeField(blank=True, null=True, verbose_name='Delivered At')),
                ('read_at', models.DateTimeField(blank=True, null=True, verbose_name='Read At')),
                ('action_url', models.URLField(blank=True, max_length=500, verbose_name='Action URL')),
                ('action_label', models.CharField(blank=True, max_length=50, verbose_name='Action Label')),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional data related to this notification', verbose_name='Metadata')),
                ('object_id', models.PositiveIntegerField(blank=True, null=True, verbose_name='Object ID')),
                ('content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='contenttypes.contenttype', verbose_name='Content Type')),
                ('recipient_company', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='received_notifications', to='tenants.company', verbose_name='Recipient Company')),
                ('recipient_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to=settings.AUTH_USER_MODEL, verbose_name='Recipient User')),
                ('sender_company', models.ForeignKey(blank=True, help_text='Company that sent the notification (null for system)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='sent_notifications', to='tenants.company', verbose_name='Sender Company')),
                ('sender_user', models.ForeignKey(blank=True, help_text='User that sent the notification (null for system/company)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sent_notifications', to=settings.AUTH_USER_MODEL, verbose_name='Sender User')),
            ],
            options={
                'verbose_name': 'Notification',
                'verbose_name_plural': 'Notifications',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='NotificationPreference',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('in_app_enabled', models.BooleanField(default=True, verbose_name='In-App Enabled')),
                ('email_enabled', models.BooleanField(default=True, verbose_name='Email Enabled')),
                ('push_enabled', models.BooleanField(default=False, verbose_name='Push Enabled')),
                ('sms_enabled', models.BooleanField(default=True, verbose_name='SMS Enabled')),
                ('type_preferences', models.JSONField(blank=True, default=dict, help_text="{ 'appointment_reminder': {'email': True, 'push': False}, ... }", verbose_name='Type Preferences')),
                ('quiet_hours_enabled', models.BooleanField(default=False, verbose_name='Quiet Hours Enabled')),
                ('quiet_hours_start', models.TimeField(default=datetime.time(22, 0), verbose_name='Quiet Hours Start')),
                ('quiet_hours_end', models.TimeField(default=datetime.time(8, 0), verbose_name='Quiet Hours End')),
                ('daily_digest_enabled', models.BooleanField(default=False, help_text='Bundle multiple notifications into a single digest', verbose_name='Daily Digest Enabled')),
                ('max_notifications_per_day', models.PositiveIntegerField(default=50, verbose_name='Max Notifications Per Day')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='notification_preferences', to=settings.AUTH_USER_MODEL, verbose_name='User')),
            ],
            options={
                'verbose_name': 'Notification Preference',
                'verbose_name_plural': 'Notification Preferences',
            },
        ),
        migrations.CreateModel(
            name='NotificationTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Updated At')),
                ('code', models.CharField(help_text='Unique identifier for this template within the company', max_length=100, verbose_name='Template Code')),
                ('name', models.CharField(max_length=200, verbose_name='Template Name')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('available_variables', models.JSONField(blank=True, default=dict, help_text='Dictionary of variable names and their descriptions', verbose_name='Available Variables')),
                ('is_active', models.BooleanField(default=True, verbose_name='Is Active')),
                ('notification_type', models.CharField(help_text='Type of notification this template is for', max_length=50, verbose_name='Notification Type')),
                ('is_system_template', models.BooleanField(default=False, help_text='System templates cannot be edited by tenants', verbose_name='Is System Template')),
                ('in_app_enabled', models.BooleanField(default=True, verbose_name='In-App Enabled')),
                ('in_app_title', models.CharField(blank=True, max_length=255, verbose_name='In-App Title')),
                ('in_app_message', models.TextField(blank=True, verbose_name='In-App Message')),
                ('email_enabled', models.BooleanField(default=False, verbose_name='Email Enabled')),
                ('email_subject', models.CharField(blank=True, max_length=255, verbose_name='Email Subject')),
                ('email_body_text', models.TextField(blank=True, verbose_name='Email Body (Text)')),
                ('email_body_html', models.TextField(blank=True, verbose_name='Email Body (HTML)')),
                ('push_enabled', models.BooleanField(default=False, verbose_name='Push Enabled')),
                ('push_title', models.CharField(blank=True, max_length=100, verbose_name='Push Title')),
                ('push_body', models.CharField(blank=True, max_length=250, verbose_name='Push Body')),
                ('sms_enabled', models.BooleanField(default=False, verbose_name='SMS Enabled')),
                ('sms_body', models.CharField(blank=True, help_text='Max 160 chars (70 with Turkish chars)', max_length=160, verbose_name='SMS Body')),
                ('company', models.ForeignKey(blank=True, help_text='If null, this is a system-wide template', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_templates', to='tenants.company', verbose_name='Company')),
            ],
            options={
                'verbose_name': 'Notification Template',
                'verbose_name_plural': 'Notification Templates',
            },
        ),
        migrations.CreateModel(
            name='OutboundMessage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Updated At')),
                ('recipient_phone', models.CharField(max_length=20, verbose_name='Recipient Phone')),
                ('recipient_name', models.CharField(blank=True, max_length=200, verbose_name='Recipient Name')),
                ('content', models.TextField(verbose_name='Message Content')),
                ('channel', models.CharField(choices=[('sms', 'SMS'), ('email', 'Email'), ('push', 'Push Notification'), ('whatsapp', 'WhatsApp'), ('telegram', 'Telegram'), ('in_app', 'In-App')], default='sms', max_length=20, verbose_name='Channel')),
                ('message_type', models.CharField(choices=[('transactional', 'Transactional'), ('promotional', 'Promotional'), ('otp', 'OTP Verification'), ('notification', 'Notification')], default='transactional', max_length=30, verbose_name='Message Type')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('delivered', 'Delivered'), ('failed', 'Failed'), ('read', 'Read'), ('rejected', 'Rejected')], default='pending', max_length=20, verbose_name='Status')),
                ('provider_message_id', models.CharField(blank=True, db_index=True, max_length=255, verbose_name='Provider Message ID')),
                ('provider_response', models.JSONField(blank=True, help_text='Raw response from the provider', null=True, verbose_name='Provider Response')),
                ('credits_used', models.PositiveIntegerField(default=1, verbose_name='Credits Used')),
                ('scheduled_at', models.DateTimeField(blank=True, null=True, verbose_name='Scheduled At')),
                ('sent_at', models.DateTimeField(blank=True, null=True, verbose_name='Sent At')),
                ('delivered_at', models.DateTimeField(blank=True, null=True, verbose_name='Delivered At')),
                ('error_message', models.TextField(blank=True, verbose_name='Error Message')),
                ('retry_count', models.PositiveIntegerField(default=0, verbose_name='Retry Count')),
                ('max_retries', models.PositiveIntegerField(default=3, verbose_name='Max Retries')),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional data related to this message', verbose_name='Metadata')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='outbound_messages', to='tenants.company', verbose_name='Company')),
                ('notification', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='outbound_messages', to='communications.notification', verbose_name='Related Notification')),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='messages', to='providers.smsprovider', verbose_name='Provider')),
            ],
            options={
                'verbose_name': 'Outbound Message',
                'verbose_name_plural': 'Outbound Messages',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DeliveryLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('channel', models.CharField(choices=[('sms', 'SMS'), ('email', 'Email'), ('push', 'Push Notification'), ('whatsapp', 'WhatsApp'), ('telegram', 'Telegram'), ('in_app', 'In-App')], default='sms', max_length=20, verbose_name='Channel')),
                ('recipient', models.CharField(help_text='Phone number, email address, or user identifier', max_length=255, verbose_name='Recipient')),
                ('content', models.TextField(verbose_name='Content')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('delivered', 'Delivered'), ('failed', 'Failed'), ('read', 'Read'), ('rejected', 'Rejected')], default='pending', max_length=20, verbose_name='Status')),
                ('error_message', models.TextField(blank=True, verbose_name='Error Message')),
                ('provider_response', models.JSONField(blank=True, default=dict, help_text='Raw response from the delivery provider', verbose_name='Provider Response')),
                ('message_id', models.CharField(blank=True, help_text='External message ID from the provider', max_length=100, verbose_name='Message ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(blank=True, help_text='Company that owns this log (null for system notifications)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='delivery_logs', to='tenants.company', verbose_name='Company')),
                ('email_provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delivery_logs', to='providers.emailprovider', verbose_name='Email Provider')),
                ('sms_provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delivery_logs', to='providers.smsprovider', verbose_name='SMS Provider')),
            ],
            options={
                'verbose_name': 'Delivery Log',
                'verbose_name_plural': 'Delivery Logs',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['recipient', 'channel'], name='communicati_recipie_0137a2_idx'), models.Index(fields=['company', 'created_at'], name='communicati_company_c0ff36_idx'), models.Index(fields=['status', 'created_at'], name='communicati_status_12967b_idx')],
            },
        ),
        migrations.CreateModel(
            name='MessageTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Updated At')),
                ('code', models.CharField(help_text='Unique identifier for this template within the company', max_length=100, verbose_name='Template Code')),
                ('name', models.CharField(max_length=200, verbose_name='Template Name')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('available_variables', models.JSONField(blank=True, default=dict, help_text='Dictionary of variable names and their descriptions', verbose_name='Available Variables')),
                ('is_active', models.BooleanField(default=True, verbose_name='Is Active')),
                ('sms_enabled', models.BooleanField(default=True, verbose_name='SMS Enabled')),
                ('sms_template', models.TextField(blank=True, help_text='Max 160 chars (70 with Turkish chars)', verbose_name='SMS Template')),
                ('whatsapp_enabled', models.BooleanField(default=False, verbose_name='WhatsApp Enabled')),
                ('whatsapp_template', models.TextField(blank=True, verbose_name='WhatsApp Template')),
                ('telegram_enabled', models.BooleanField(default=False, verbose_name='Telegram Enabled')),
                ('telegram_template', models.TextField(blank=True, verbose_name='Telegram Template')),
                ('company', models.ForeignKey(blank=True, help_text='If null, this is a system-wide template', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_templates', to='tenants.company', verbose_name='Company')),
            ],
            options={
                'verbose_name': 'Message Template',
                'verbose_name_plural': 'Message Templates',
                'unique_together': {('company', 'code')},
            },
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['recipient_user', 'status'], name='communicati_recipie_593f33_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['recipient_company', 'status'], name='communicati_recipie_4f3959_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['sender_company'], name='communicati_sender__f76d85_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['notification_type', 'created_at'], name='communicati_notific_5c544d_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['scheduled_at', 'status'], name='communicati_schedul_eb91d5_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='notificationtemplate',
            unique_together={('company', 'code')},
        ),
        migrations.AddIndex(
            model_name='outboundmessage',
            index=models.Index(fields=['company', 'status', 'created_at'], name='communicati_company_2311a5_idx'),
        ),
        migrations.AddIndex(
            model_name='outboundmessage',
            index=models.Index(fields=['provider_message_id'], name='communicati_provide_f67cef_idx'),
        ),
        migrations.AddIndex(
            model_name='outboundmessage',
            index=models.Index(fields=['recipient_phone', 'created_at'], name='communicati_recipie_5d8cdf_idx'),
        ),
    ]
